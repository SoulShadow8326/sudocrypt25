{{define "chat"}}
<link rel="stylesheet" href="/components/chat/chat.css">
    <script>
        (function () {
            window.__userEmail = '';
            try {
                fetch('/api/me', { credentials: 'same-origin' }).then(function (resp) {
                    if (!resp.ok) return null;
                    return resp.json();
                }).then(function (js) {
                    if (js && js.email) window.__userEmail = js.email || '';
                }).catch(function () {});
            } catch (e) {}
        })();
    </script>
    <div id="chatToggleBtn">
        <button id="btn-message" class="button-message" type="button" aria-expanded="false" aria-controls="chatPopup">
            <div class="content-avatar">
                <div class="avatar">
                    <img src="components/assets/message-circle.svg" alt="Chat" class="user-img">
                </div>
            </div>
            <div class="chat-toggle-notification-dot" id="chatToggleNotificationDot"></div>
        </button>
    </div>
    

    <div id="chatPopup">
        <div id="chatControls">
            <div class="chat-controls-left">
                <div id="chatCloseBtn" class="chat-control-btn">
                    <svg width="7" height="7" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2L2 14" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="round" />
                        <path d="M2 2L14 14" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="round" />
                    </svg>
                </div>
                <div id="chatMinimizeBtn" class="chat-control-btn">
                    <svg width="7" height="7" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8h8" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </div>
                <div id="chatMaximizeBtn" class="chat-control-btn">
                    <svg width="7" height="7" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="3" width="10" height="10" stroke="currentColor" stroke-width="2" fill="none" />
                    </svg>
                </div>
            </div>
            <div class="chat-controls-right">
                <div class="chat-status-indicator" id="chattatusIndicator">
                    <span class="status-text" id="statusText">Active</span>
                </div>
                <div class="notification-dot" id="chatNotificationDot"></div>
            </div>
        </div>
        <div class="chat-header">
            <div class="chat-title-area">
                <div class="chat-tabs">
                    <div class="chat-tab active" onclick="switchChatTab('leads')" data-tab="leads">
                        <span class="tab-text">Leads</span>
                        <span class="tab-badge" id="leadsBadge" style="display: none;">0</span>
                    </div>
                    <div class="chat-tab" onclick="switchChatTab('hints')" data-tab="hints">
                        <span class="tab-text">Hints</span>
                        <span class="tab-badge" id="hintsBadge" style="display: none;">0</span>
                    </div>
                </div>
            </div>
        </div>
        <div id="chatContent" class="chat-tab-content active">
            <div id="leadsDisabledNotice" style="padding: 12px; text-align: center; color: rgba(255, 255, 255, 0.9); background: rgba(255, 255, 255, 0.02); border-radius: 6px; font-size: 14px; margin: 8px;">Leads have been turned off<br><button class="btn-primary" style="margin-top: 8px;">Ask AI</button></div>
            <div class="chat-content-area">
                <div class="chat-info">
                    <div class="info-box">
                    </div>
                </div>
                
                <div id="chatContainer" class="chat-messages-container no-scrollbar">
                    <div class="empty-state">
                        <div class="empty-state">
                        <p style="font-size: 52px; color: #ffffff; padding: 0px;">Sudocrypt</p>
                        <p style="color: #888888;">sudocrypt is a 36 hour cryptic hunt</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="input-wrapper">
                    <input
                        type="text"
                        placeholder="Ask a question..."
                        id="chatInput"
                        class="chat-input"
                        maxlength="512"
                        spellcheck="false"
                        autocomplete="off"
                        autocapitalize="off">
                    <div id="chatCooldownTimer" style="min-width:36px; text-align:center; color:rgba(255,255,255,0.6); font-size:13px; margin-right:8px;"></div>
                    <button id="chatendButton" class="send-button" title="Contact chat" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="#9722e5" viewBox="0 0 664 663" width="16" height="16">
                            <path stroke-linejoin="round" stroke-linecap="round" stroke-width="33.67" stroke="currentColor"
                                d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="hintsContent" class="chat-tab-content">
            <div class="chat-content-area">
                <div class="hints-info">
                    <div class="info-box">
                    </div>
                </div>
                
                <div id="hintsContainer" class="chat-messages-container no-scrollbar">
                    <div class="empty-state">
                        <div class="empty-icon">?</div>
                        <p>No hints available yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script defer type="module" src="/components/chat/chat.js"></script>
{{end}}
